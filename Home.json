[{"Type":"H1","Content":"Help! I need a CMS in 30 minutes, what should I do?"},{"Type":"Paragraph","Content":"This is the companion app for my Booster talk. Scroll down to find the code for Google App Scripts!"},{"Type":"Spacer"},{"Type":"Image","Content":"Closeup picture of blue waves bathed in sunlight","Link":"https://images.unsplash.com/photo-1488188840666-e2308741a62f?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2948&q=80"},{"Type":"Spacer"},{"Type":"H2","Content":"Code"},{"Type":"Paragraph","Content":"Below, you can find the Google App Script used in this talk, which you are free to copy! This solution uploades changes to Github, but you can easily substitute S3 or any other CDN as per your preference!"},{"Type":"Spacer"},{"Type":"Pre","Content":"/**\n * Add menu-option for publishing a sheet\n */\nfunction onOpen() {\n  var ui = SpreadsheetApp.getUi();\n  ui.createMenu('CMS')\n    .addItem('Publiser endringer', 'publish')\n    .addToUi();\n}\n\n/**\n * Publish changes in the active sheet\n */\nfunction publish() {\n  var sheet = SpreadsheetApp.getActiveSheet();\n\n  // Get the 2D array of cell values (CSV-data) from the active sheet\n  var sheetData = sheet.getDataRange().getValues();\n\n  var sheetName = sheet.getName();\n  var filename = sheetName + \".json\";\n\n  var parsedData = transformTableDataToJson(sheetData);\n\n  // Upload to external CDN / Storage\n  upload(filename, parsedData);\n}\n\n/**\n * Transforms table data (2D array of cell values) to an array of JSON objects, \n * where the columns of the first row is treated as keys for that column in the other rows. \n */\nfunction transformTableDataToJson(data) {\n  var keys = data.slice(0, 1)[0];\n\n  return data\n    .slice(1)\n    .map((x) =>\n      x.reduce((acc, cur, i) => {\n        if (cur === \"\") return acc;\n        acc[keys[i]] = cur;\n        return acc;\n      }, {}));\n}\n\n/**\n *  Uploads the data of a sheet to a file somewhere in the cloud (in this case, github).\n */\nfunction upload(filename, data) {\n  var existingFile = null;\n\n  try {\n    existingFile = JSON.parse(UrlFetchApp.fetch(\"https://api.github.com/repos/oysmal/help-i-need-a-cms-in-ten-minutes/contents/\" + filename, {\n      method: \"get\",\n      headers: {\n        'Authorization': `Bearer ${getGithubApiToken()}`,\n        'Content-Type': 'application/json'\n      }\n    }));\n  } catch (e) { }\n\n  var githubData = JSON.stringify({\n    \"message\": \"Update json file\",\n    \"sha\": existingFile?.sha,\n    \"content\": Utilities.base64Encode(JSON.stringify(data), Utilities.Charset.UTF_8),\n  });\n\n\n  UrlFetchApp.fetch(\"https://api.github.com/repos/oysmal/help-i-need-a-cms-in-ten-minutes/contents/\" + filename, {\n    method: \"put\",\n    payload: githubData,\n    headers: {\n      'Authorization': `Bearer ${getGithubApiToken()}`,\n      'Content-Type': 'application/json'\n    }\n  });\n}\n\nfunction getGithubApiToken() {\n  return \"YOUR GITHUB API TOKEN HERE\";\n}"}]